<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9fb;
      color: #333;
    }

    header {
      background: #4a69bd;
      color: white;
      padding: 15px 30px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    nav {
      display: flex;
      justify-content: center;
      background: #f1f2f6;
      padding: 12px;
      gap: 15px;
    }

    nav button {
      background: #4a69bd;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 15px;
    }
    nav button:hover {
      background: #3c57a5;
    }

    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }

    section {
      display: none;
      margin-top: 20px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

    section.active {
      display: block;
    }

    h2 {
      margin-bottom: 15px;
      font-size: 20px;
      color: #4a69bd;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }

    thead {
      background: #f1f2f6;
    }

    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    tr:hover {
      background: #f9f9f9;
    }

    th {
      font-weight: bold;
      font-size: 14px;
      color: #333;
    }

    .action-btn {
      padding: 5px 12px;
      border: none;
      border-radius: 5px;
      font-size: 13px;
      cursor: pointer;
      transition: 0.2s;
    }

    .edit {
      background: #ffc107;
      color: #333;
    }
    .edit:hover {
      background: #e0a800;
    }

    .delete {
      background: #dc3545;
      color: white;
    }
    .delete:hover {
      background: #c82333;
    }

    #loading {
      text-align: center;
      padding: 20px;
      font-size: 16px;
      color: #4a69bd;
      display: none;
    }

    @media (max-width: 768px) {
      table {
        font-size: 12px;
      }
      nav {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>Admin Dashboard</header>
  <nav>
    <button onclick="showSection('students')">üìò Students Data</button>
    <button onclick="showSection('recruiters')">üè¢ Recruiters Data</button>
  </nav>

  <div class="container">
    <div id="loading">Loading data...</div>

    <section id="students">
      <h2>Students Data</h2>
      <table id="studentsTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="recruiters">
      <h2>Recruiters Data</h2>
      <table id="recruitersTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script>
    const supabaseUrl = "https://xozzpzasbdvgpyysuvew.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvenpwemFzYmR2Z3B5eXN1dmV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3MDA0NjMsImV4cCI6MjA3MzI3NjQ2M30.SiiaH38cNz21EHpvGOZNQCQ5vW2f6H2GBocGn4qYfGM";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function fetchData(table, tableId) {
      document.getElementById("loading").style.display = "block";
      const { data, error } = await supabase.from(table).select("*");
      document.getElementById("loading").style.display = "none";

      if (error) {
        console.error("Error fetching:", error);
        alert("Failed to fetch data: " + error.message);
        return;
      }
      if (!data || data.length === 0) {
        document.getElementById(tableId).innerHTML = "<p>No data found</p>";
        return;
      }
      renderTable(data, tableId, table);
    }

    function renderTable(data, tableId, tableName) {
      const table = document.getElementById(tableId);
      const thead = table.querySelector("thead");
      const tbody = table.querySelector("tbody");

      thead.innerHTML = "";
      tbody.innerHTML = "";

      const headers = Object.keys(data[0]);
      const headerRow = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      const actionTh = document.createElement("th");
      actionTh.textContent = "Actions";
      headerRow.appendChild(actionTh);
      thead.appendChild(headerRow);

      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = row[h];
          tr.appendChild(td);
        });

        const actionTd = document.createElement("td");
        const editBtn = document.createElement("button");
        editBtn.textContent = "Edit";
        editBtn.className = "action-btn edit";
        editBtn.onclick = () => updateRow(tableName, row);

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete";
        deleteBtn.className = "action-btn delete";
        deleteBtn.onclick = () => deleteRow(tableName, row);

        actionTd.appendChild(editBtn);
        actionTd.appendChild(deleteBtn);
        tr.appendChild(actionTd);

        tbody.appendChild(tr);
      });
    }

    async function updateRow(table, row) {
      const field = prompt("Enter the column name to update:");
      const newValue = prompt(`Enter new value for ${field}:`);
      if (!field || !newValue) return;

      const uniqueCol = table === "InternsData" ? "Email" : "CompanyName";

      const { error } = await supabase.from(table)
        .update({ [field]: newValue })
        .match({ [uniqueCol]: row[uniqueCol] });

      if (error) console.error("Error updating:", error);
      else fetchData(table, table === "InternsData" ? "studentsTable" : "recruitersTable");
    }

    async function deleteRow(table, row) {
      if (!confirm("Are you sure to delete this row?")) return;

      const uniqueCol = table === "InternsData" ? "Email" : "CompanyName";

      const { error } = await supabase.from(table)
        .delete()
        .match({ [uniqueCol]: row[uniqueCol] });

      if (error) console.error("Error deleting:", error);
      else fetchData(table, table === "InternsData" ? "studentsTable" : "recruitersTable");
    }

    function showSection(section) {
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.getElement
          function showSection(section) {
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.getElementById(section).classList.add("active");

      if (section === "students") {
        fetchData("InternsData", "studentsTable");
      } else {
        fetchData("CompaniesData", "recruitersTable");
      }
    }

    // Auto-load students section on page load
    window.onload = () => showSection("students");
  </script>
</body>
</html>
