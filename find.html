<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Find Internships</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    select, button { margin: 8px; padding: 6px; }
    .internship-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      background: #f9f9f9;
    }
  </style>
</head>
<body>

  <h1>Find Internships</h1>

  <!-- ✅ Filters -->
  <label>Degree:</label>
  <select id="degree">
    <option disabled selected>Select Degree</option>
    <option>B.A.</option>
    <option>B.Com</option>
    <option>B.E.</option>
    <option>B.Sc.</option>
    <option>B.Tech</option>
    <option>BBA</option>
    <option>Diploma</option>
  </select>

  <label>Language:</label>
  <select id="language">
    <option disabled selected>Select Language</option>
    <option>Hindi</option>
    <option>English</option>
    <option>Bengali</option>
    <option>Tamil</option>
    <option>Telugu</option>
  </select>

  <label>Skill:</label>
  <select id="skill">
    <option disabled selected>Select Skill</option>
    <option>Python</option>
    <option>SQL</option>
    <option>C++</option>
    <option>Java</option>
    <option>Marketing</option>
    <option>Machine Learning</option>
  </select>

  <label>Specialisation:</label>
  <select id="specialisation">
    <option disabled selected>Select Specialisation</option>
    <option>Computer Science</option>
    <option>Chemical</option>
    <option>Mechanical Engineering</option>
    <option>Finance</option>
    <option>Biotechnology</option>
  </select>

  <label>Domain:</label>
  <select id="domain">
    <option disabled selected>Select Domain</option>
    <option>Engineering</option>
    <option>Data Analytics</option>
    <option>Consulting</option>
    <option>Design</option>
    <option>Finance</option>
  </select>

  <br><br>
  <button onclick="searchInternships()">Search Internships</button>

  <!-- ✅ Results -->
  <div id="internshipResults"></div>

  <script>
    // ✅ Supabase client setup
    const SUPABASE_URL = "https://xozzpzasbdvgpyysuvew.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvenpwemFzYmR2Z3B5eXN1dmV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3MDA0NjMsImV4cCI6MjA3MzI3NjQ2M30.SiiaH38cNz21EHpvGOZNQCQ5vW2f6H2GBocGn4qYfGM";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ✅ Fetch companies table
    async function fetchCompanies() {
      const { data, error } = await supabase.from("companies").select("*");
      if (error) {
        console.error("Error fetching companies:", error);
        return [];
      }
      return data;
    }

    // ✅ Matching function
    function findMatchingCompanies(student, companies) {
      return companies.filter(company => {
        let match = true;

        // Degree
        if (student.degree && company.degree && company.degree.trim().toLowerCase() !== student.degree.trim().toLowerCase()) {
          match = false;
        }

        // Specialisation
        if (student.specialisation && company.specialisation && company.specialisation.trim().toLowerCase() !== student.specialisation.trim().toLowerCase()) {
          match = false;
        }

        // Domain
        if (student.domain && company.domain && company.domain.trim().toLowerCase() !== student.domain.trim().toLowerCase()) {
          match = false;
        }

        // Skills (partial match allowed)
        if (student.skill) {
          const skillMatch = company.skills.toLowerCase().includes(student.skill.toLowerCase());
          if (!skillMatch) match = false;
        }

        // Languages (partial match allowed)
        if (student.language) {
          const langMatch = company.languages.toLowerCase().includes(student.language.toLowerCase());
          if (!langMatch) match = false;
        }

        return match;
      });
    }

    // ✅ Search function
    async function searchInternships() {
      const studentInput = {
        degree: document.getElementById("degree").value,
        language: document.getElementById("language").value,
        skill: document.getElementById("skill").value,
        specialisation: document.getElementById("specialisation").value,
        domain: document.getElementById("domain").value
      };

      const companies = await fetchCompanies();
      const matches = findMatchingCompanies(studentInput, companies);

      const container = document.getElementById("internshipResults");
      container.innerHTML = "";

      if (matches.length === 0) {
        container.innerHTML = "<p>No matching internships found.</p>";
        return;
      }

      matches.forEach(c => {
        const card = document.createElement("div");
        card.className = "internship-card";
        card.innerHTML = `
          <h3>${c.company_name}</h3>
          <p><strong>Degree Required:</strong> ${c.degree}</p>
          <p><strong>Skills:</strong> ${c.skills}</p>
          <p><strong>Specialisation:</strong> ${c.specialisation}</p>
          <p><strong>Languages:</strong> ${c.languages}</p>
          <p><strong>Domain:</strong> ${c.domain}</p>
        `;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>
